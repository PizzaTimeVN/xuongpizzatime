<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n L√Ω X∆∞·ªüng Pizza Time</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 28px;
        }

        h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .login-screen, .main-screen {
            display: none;
        }

        .login-screen.active, .main-screen.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        input[type="date"], input[type="text"], input[type="number"], select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #e74c3c;
        }

        input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background-color: #e0e0e0;
            transition: border-color 0.3s, background-color 0.3s;
        }

        input[type="password"]:focus {
            outline: none;
            border-color: #27ae60;
            background-color: #d4f5d4;
        }

        .btn {
            background: #e74c3c;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s;
        }

        .btn:hover {
            background: #c0392b;
        }

        .btn-secondary {
            background: #34495e;
        }

        .btn-secondary:hover {
            background: #2c3e50;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-start {
            background: #27ae60;
        }

        .btn-start:hover {
            background: #2ecc71;
        }

        .btn-order {
            background: #27ae60;
        }

        .btn-order:hover {
            background: #229954;
        }

        .btn-order:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .menu-card {
            background: #fff;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .menu-card:hover {
            border-color: #e74c3c;
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .menu-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .menu-card p {
            color: #777;
            font-size: 14px;
        }

        .back-btn {
            margin-bottom: 20px;
        }

        .item-row {
            display: grid;
            grid-template-columns: 2fr 1fr 100px;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }

        .items-container {
            margin: 20px 0;
        }

        .add-item-btn {
            margin: 20px 0;
        }

        .store-select {
            margin-bottom: 20px;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .alert {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .current-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .current-info span {
            font-weight: 600;
            color: #e74c3c;
        }

        .success-msg {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        /* Inventory Styles */
        .inventory-container {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .category-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .category-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
        }

        .category-header {
            padding: 16px 20px;
            background: #667eea;
            color: white;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .category-header:hover {
            background: #5568d3;
        }

        .category-header.cat-thanh-pham { background: #e74c3c; }
        .category-header.cat-nguyen-lieu { background: #3498db; }
        .category-header.cat-gia-vi { background: #27ae60; }
        .category-header.cat-bao-bi { background: #f39c12; }
        .category-header.cat-do-uong { background: #9b59b6; }

        .category-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-count {
            background: rgba(255,255,255,0.3);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
        }

        .category-icon {
            font-size: 20px;
            transition: transform 0.3s;
        }

        .category-icon.expanded {
            transform: rotate(90deg);
        }

        .category-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
        }

        .category-body.show {
            max-height: 2000px;
        }

        .item-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
            padding: 20px;
        }

        .item-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .item-card:hover {
            background: #fff;
            border-color: #e0e0e0;
            transform: translateY(-2px);
        }

        .item-card.low-stock {
            border-color: #ff6b6b;
            background: #fff5f5;
        }

        .item-name {
            font-weight: 600;
            color: #333;
            font-size: 15px;
        }

        .item-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .item-quantity {
            flex: 1;
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            text-align: center;
            font-weight: 600;
        }

        .item-quantity:focus {
            border-color: #667eea;
            outline: none;
        }

        .item-card.low-stock .item-quantity {
            border-color: #ff6b6b;
            color: #ff6b6b;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-ok {
            background: #d4edda;
            color: #155724;
        }

        .status-low {
            background: #fff3cd;
            color: #856404;
            animation: pulse 2s infinite;
        }

        .status-critical {
            background: #f8d7da;
            color: #721c24;
            animation: pulse 1.5s infinite;
        }

        /* Tables */
        .alert-table, .export-history-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .alert-table th {
            background: #e74c3c;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .export-history-table th {
            background: #3498db;
            color: white;
            padding: 14px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .alert-table td, .export-history-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #f0f0f0;
        }

        .alert-table tr:hover, .export-history-table tr:hover {
            background: #f8f9fa;
        }

        .alert-table input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .alert-table input[type="number"] {
            width: 80px;
            padding: 6px;
            border: 2px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }

        .order-actions {
            margin-top: 20px;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Store Badges */
        .store-badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 13px;
            text-align: center;
            min-width: 50px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            color: white;
        }

        .store-badge.DH { background: #e74c3c; }
        .store-badge.NH { background: #3498db; }
        .store-badge.HXH { background: #f39c12; }
        .store-badge.PY { background: #27ae60; }

        /* Export Screen */
        #exportProductScreen h3 {
            font-size: 18px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid currentColor;
        }

        #exportProductScreen > div {
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        #exportProductScreen > div:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            transform: translateY(-2px);
        }

        #exportHistoryContainer {
            background: white;
            padding: 15px;
            border-radius: 8px;
            min-height: 100px;
        }

        .no-data {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-style: italic;
            font-size: 15px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Qu·∫£n L√Ω X∆∞·ªüng Pizza Time</h1>
        
        <!-- Login Screen -->
        <div class="login-screen active" id="loginScreen">
            <div class="form-group">
                <label>Ng√†y</label>
                <input type="date" id="loginDate" />
            </div>
            <div class="form-group">
                <label>T√™n ng∆∞·ªùi nh·∫≠p</label>
                <input type="text" id="loginName" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n" />
            </div>
            <div class="form-group">
                <label>M·∫≠t kh·∫©u</label>
                <input type="password" id="loginPassword" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" />
            </div>
            <button class="btn btn-start" onclick="login()">B·∫Øt ƒê·∫ßu</button>
        </div>
        
        <!-- Main Screen -->
        <div class="main-screen" id="mainScreen">
            <div class="current-info">
                Ng√†y: <span id="currentDate"></span> | Ng∆∞·ªùi nh·∫≠p: <span id="currentUser"></span>
                <button class="btn btn-logout" onclick="logout()">ƒêƒÉng xu·∫•t</button>
            </div>

            <div class="menu-grid" id="menuGrid">
                <div class="menu-card" onclick="showScreen('rawInput')">
                    <h3>Nh·∫≠p H√†ng Th√¥</h3>
                    <p>Ghi nh·∫≠n nguy√™n li·ªáu nh·∫≠p kho</p>
                </div>
                <div class="menu-card" onclick="showScreen('productionInput')">
                    <h3>L√†m Th√†nh Ph·∫©m</h3>
                    <p>Ghi nh·∫≠n s·∫£n xu·∫•t th√†nh ph·∫©m</p>
                </div>
                <div class="menu-card" onclick="showScreen('exportProduct')">
                    <h3>Xu·∫•t Th√†nh Ph·∫©m</h3>
                    <p>Xu·∫•t h√†ng cho c√°c qu√°n</p>
                </div>
                <div class="menu-card" onclick="showScreen('inventory')">
                    <h3>T·ªìn Kho</h3>
                    <p>Xem v√† ƒëi·ªÅu ch·ªânh t·ªìn kho</p>
                </div>
                <div class="menu-card" onclick="showScreen('alerts')">
                    <h3>C·∫£nh B√°o H√†ng</h3>
                    <p>M·∫∑t h√†ng s·∫Øp h·∫øt</p>
                </div>
                <div class="menu-card" onclick="showScreen('storeInventory')">
                    <h3>T·ªìn Kho Qu√°n</h3>
                    <p>Xem h√†ng t·ªìn t·∫°i t·ª´ng qu√°n</p>
                </div>
            </div>
        </div>

        <!-- Raw Input Screen -->
        <div id="rawInputScreen" style="display:none;">
            <button class="btn btn-secondary back-btn" onclick="backToMenu()">‚Üê Quay L·∫°i</button>
            <h2>Nh·∫≠p H√†ng Th√¥</h2>
            <div id="rawSuccessMsg"></div>
            <div class="items-container" id="rawItemsContainer"></div>
            <button class="btn add-item-btn" onclick="addRawItem()">+ Th√™m M·∫∑t H√†ng</button>
            <button class="btn" onclick="saveRawInput()">L∆∞u</button>
        </div>
        
        <!-- Production Input Screen -->
        <div id="productionInputScreen" style="display:none;">
            <button class="btn btn-secondary back-btn" onclick="backToMenu()">‚Üê Quay L·∫°i</button>
            <h2>L√†m Th√†nh Ph·∫©m</h2>
            <div id="prodSuccessMsg"></div>
            <div class="items-container" id="prodItemsContainer"></div>
            <button class="btn add-item-btn" onclick="addProdItem()">+ Th√™m M·∫∑t H√†ng</button>
            <button class="btn" onclick="saveProduction()">L∆∞u</button>
        </div>
        
        <!-- Export Product Screen -->
        <div id="exportProductScreen" style="display:none;">
            <button class="btn btn-secondary back-btn" onclick="backToMenu()">‚Üê Quay L·∫°i</button>
            <h2>Xu·∫•t Th√†nh Ph·∫©m</h2>
            
            <!-- PH·∫¶N 1: L·ªäCH S·ª¨ XU·∫§T H√ÄNG -->
            <div style="background: #f8f9fa; border-radius: 12px; padding: 25px; margin-bottom: 30px; border: 2px solid #e0e0e0;">
                <h3 style="margin-top: 0; color: #3498db; display: flex; align-items: center; gap: 10px;">
                    üìã L·ªãch S·ª≠ Xu·∫•t H√†ng Ng√†y M·ªõi Nh·∫•t
                </h3>
                <div id="exportHistoryContainer">
                    <p style="text-align:center; color:#999;">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</p>
                </div>
            </div>

            <!-- PH·∫¶N 2: FORM XU·∫§T H√ÄNG M·ªöI -->
            <div style="background: #fff; border-radius: 12px; padding: 25px; border: 2px solid #e74c3c;">
                <h3 style="margin-top: 0; color: #e74c3c; display: flex; align-items: center; gap: 10px;">
                    üì¶ T·∫°o ƒê∆°n Xu·∫•t H√†ng M·ªõi
                </h3>
                
                <div id="exportSuccessMsg"></div>
                
                <div class="store-select">
                    <label>Ch·ªçn Qu√°n</label>
                    <select id="storeSelect">
                        <option value="DH">DH</option>
                        <option value="NH">NH</option>
                        <option value="HXH">HXH</option>
                        <option value="PY">PY</option>
                        <option value="Xuong">Xuong</option>
                    </select>
                </div>
                
                <div class="items-container" id="exportItemsContainer"></div>
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn add-item-btn" onclick="addExportItem()" style="flex: 1;">+ Th√™m M·∫∑t H√†ng</button>
                    <button class="btn" onclick="saveExport()" style="flex: 1; background: #27ae60;">üíæ L∆∞u ƒê∆°n Xu·∫•t H√†ng</button>
                </div>
            </div>
        </div>
        
        <!-- Inventory Screen -->
        <div id="inventoryScreen" style="display:none;">
            <button class="btn btn-secondary back-btn" onclick="backToMenu()">‚Üê Quay L·∫°i</button>
            <h2>T·ªìn Kho</h2>
            <div class="search-box">
                <input type="text" id="inventorySearch" placeholder="üîç T√¨m ki·∫øm m·∫∑t h√†ng..." onkeyup="searchInventory()" />
            </div>
            <div id="inventoryContainer" class="inventory-container"></div>
        </div>
        
        <!-- Alerts Screen -->
        <div id="alertsScreen" style="display:none;">
            <button class="btn btn-secondary back-btn" onclick="backToMenu()">‚Üê Quay L·∫°i</button>
            <h2>C·∫£nh B√°o H√†ng S·∫Øp H·∫øt</h2>
            <div id="alertsContainer"></div>
        </div>

        <!-- Store Inventory Screen -->
        <div id="storeInventoryScreen" style="display:none;">
            <button class="btn btn-secondary back-btn" onclick="backToMenu()">‚Üê Quay L·∫°i</button>
            <h2>T·ªìn Kho C√°c Qu√°n</h2>
            <div class="store-select">
                <label>Ch·ªçn Qu√°n</label>
                <select id="storeInventorySelect" onchange="loadStoreInventory()">
                    <option value="">-- Ch·ªçn Qu√°n --</option>
                    <option value="DH">DH</option>
                    <option value="NH">NH</option>
                    <option value="HXH">HXH</option>
                    <option value="PY">PY</option>
                </select>
            </div>
            <div id="storeInventoryContainer"></div>
        </div>
    </div>

    <script>
        // Supabase configuration
        const SUPABASE_URL = 'https://tyuufjwutazjfuiawiul.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR5dXVmand1dGF6amZ1aWF3aXVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA1MDk4OTIsImV4cCI6MjA3NjA4NTg5Mn0.8WEsb2tBD6akNA9h9tR9zIAqjkZz0xZYVNbYCx2dEbc';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        // Discord Webhook URL - THAY ƒê·ªîI URL N√ÄY B·∫∞NG WEBHOOK C·ª¶A B·∫†N
        const DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1387472354149400748/t4uIPrQMAPg1MuUDOm8DW3r-2dDXQMQhdVxJ8QrUPX9igBBwyOOrsxVIdRQDzclI5smh';
        
        let inventoryData = {};
        
        // Categories and items
        const categories = {
            "Th√†nh ph·∫©m": [
                'ƒê·∫ø L', 'ƒê·∫ø S', 'Ph√¥ Mai L', 'Ph√¥ Mai S', 'B√≤ pizza (b·ªãch)', 'B√≤ m√¨ √ù (b·ªãch)',
                'G√† pizza (b·ªãch)', 'T√¥m (b·ªãch)', 'M·ª±c (b·ªãch)', 'C√° Ng·ª´ (b·ªãch)', 'XXH (b·ªãch)',
                'XXƒê (b·ªãch)', 'Ba R·ªçi (b·ªãch)', 'B√≤ s·ªët cay (b·ªãch)', 'S·ªët s·ªØa (b·ªãch)', 'S·ªët c√† (h≈©)',
                'S·ªët G√†', 'Salami (b·ªãch)', 'ƒê√πi G√† (c√°i)', 'ƒê√° Me (b·ªãch)', 'G√† L·∫Øc (b·ªãch)',
                'XX Chi√™n X√π', 'M·ª©t ƒë√†o (b·ªãch)', 'KTC (b·ªãch)', 'Tok (b·ªãch)', 'Mi·∫øng ƒë√†o (b·ªãch)',
                'N·∫•m (b·ªãch)', 'B√¥ng C·∫£i Xanh (b·ªãch)', 'Bom Ph√¥ Mai (vi√™n)'
            ],
            "Nguy√™n li·ªáu s·ªëng": [
                'Ph√¥ mai cam', 'Ph√¥ mai Topping', 'Ph√¥ Mai Emborg', 'Ph√¥ mai tr·∫Øng', 'Ph√¥ mai v√†ng',
                'Ph√¥ mai t∆∞∆°i', 'B√≤ nguy√™n', 'G√† ·ª©c', 'ƒê√πi G√†', 'B√≤ Mi·∫øng S·ªëng', 'T√¥m s·ªëng (ph·∫ßn)',
                'M·ª±c s·ªëng (ph·∫ßn)', 'Thanh Cua Nguy√™n', 'Ba R·ªçi Nguy√™n', 'X√∫c x√≠ch ƒê·ª©c Nguy√™n', 'X√∫c x√≠ch heo nguy√™n',
                'C√† chua', 'C√† r·ªët', 'H√†nh T√¢y', 'Khoai T√¢y (C·ªß)', 'Khoai T√¢y Chi√™n Nguy√™n', 'C√° ng·ª´ h≈© L', 'C√° ng·ª´ h≈© S'
            ],
            "Gia v·ªã & nguy√™n li·ªáu kh√¥": [
                'Men (b√¨)', 'B·ªôt (bao)', 'ƒê∆∞·ªùng (b√¨)', 'Mu·ªëi (b√¨)', 'X√¨ d·∫ßu (chai)', 'R∆∞·ª£u (chai)',
                'Ti√™u', 'D·∫ßu ƒÉn (can)', 'D·∫ßu H√†o (chai)','M√¨ √ù Nguy√™n', 'B·∫Øp (Kg)', 'Mayo nh·ªè', 'Mayo l·ªõn', 'B∆°', 
                'C√† chua paste', 'B·ªôt chi√™n g√† (b·ªãch)', 'B·ªôt ph√¥ mai l·∫Øc g√†'
            ],
            "Bao b√¨ & v·∫≠t d·ª•ng": [
                'Bao 1 m√≥n (kg)', 'Bao c√¢n b√≤ (kg)', 'Bao c√¢n m√¨ (kg)', 'B√¨ v√†ng (kg)', 'Bao Pizza L·ªõn (kg)',
                'Bao r√°c (kg)', 'D√¢y thun (b·ªãch)', 'Ly nh·ª±a (l·ªëc)', 'Bao ƒê·∫ø L (kg)', 'Bao ƒê·∫ø S (kg)', 'Gi·∫•y n·∫øn', 'Gi·∫•y KTC',
                'Th√πng L', 'Th√πng S'
            ],
            "ƒê·ªì u·ªëng & b√°nh": [
                'Coca chai', 'Coca lon', 'N∆∞·ªõc su·ªëi', 'Bia Blance', 'Bia Quy Nh∆°n', 'B√°nh m√¨'
            ]
        };
        
        // Set default date to today
        document.getElementById('loginDate').valueAsDate = new Date();
        
        const users = {
            "Bo": "123",
            "Nhu2k6": "Xinh@Dep",
            "Ngan2k2": "Dep$Gioi",
            "admin": "123"
        };

        let currentDate = '';
        let currentUser = '';

        function login() {
            const date = document.getElementById('loginDate').value;
            const name = document.getElementById('loginName').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!date || !name || !password) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                return;
            }

            if (!(name in users) || users[name] !== password) {
                alert('T√™n ng∆∞·ªùi d√πng ho·∫∑c m·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!');
                return;
            }

            currentDate = date;
            currentUser = name;

            localStorage.setItem('currentDate', currentDate);
            localStorage.setItem('currentUser', currentUser);

            document.getElementById('loginScreen').classList.remove('active');
            document.getElementById('mainScreen').classList.add('active');

            document.getElementById('currentDate').textContent = currentDate;
            document.getElementById('currentUser').textContent = currentUser;

            loadInventory();
        }

        function logout() {
            currentDate = '';
            currentUser = '';
            localStorage.removeItem('currentDate');
            localStorage.removeItem('currentUser');

            document.getElementById('mainScreen').classList.remove('active');
            document.getElementById('loginScreen').classList.add('active');

            document.getElementById('loginDate').value = '';
            document.getElementById('loginName').value = '';
            document.getElementById('loginPassword').value = '';
        }

        // Load Inventory
        async function loadInventory() {
            const { data, error } = await supabase
                .from('inventory')
                .select('*');

            if (error) {
                console.error('L·ªói load inventory:', error);
                return;
            }

            inventoryData = {};
            data.forEach(row => {
                inventoryData[row.item] = row.quantity;
            });

            displayInventory();
            displayAlerts();
        }

        // Update Inventory
        async function updateInventory(itemName, quantityChange, type = 'manual', store = null) {
            const currentQty = inventoryData[itemName] || 0;
            const newQty = currentQty + quantityChange;
            inventoryData[itemName] = newQty;

            const { error: invError } = await supabase
                .from('inventory')
                .upsert({ item: itemName, quantity: newQty }, { onConflict: 'item' });

            if (invError) console.error('‚ùå L·ªói ghi inventory:', invError);

            const today = new Date().toISOString().slice(0, 10);

            if (type === 'raw_input') {
                const { error } = await supabase.from('raw_materials_input').insert([{
                    date: today,
                    user_name: currentUser,
                    item: itemName,
                    quantity: quantityChange
                }]);
                if (error) console.error('‚ùå L·ªói ghi raw_materials_input:', error);

            } else if (type === 'production') {
                const { error } = await supabase.from('production').insert([{
                    date: today,
                    user_name: currentUser,
                    item: itemName,
                    quantity: quantityChange
                }]);
                if (error) console.error('‚ùå L·ªói ghi production:', error);

            } else if (type === 'export') {
                const { error } = await supabase.from('exports').insert([{
                    date: today,
                    user_name: currentUser,
                    store: store,
                    item: itemName,
                    quantity: quantityChange
                }]);
                if (error) console.error('‚ùå L·ªói ghi exports:', error);
            }

            displayInventory();
            displayAlerts();
        }

        // Item Row UI
        function createItemRow(containerId, categoryList) {
            const container = document.getElementById(containerId);
            const row = document.createElement('div');
            row.className = 'item-row';

            let optionsHTML = '<option value="">-- Ch·ªçn m·∫∑t h√†ng --</option>';
            for (let cat in categoryList) {
                optionsHTML += `<optgroup label="${cat}">`;
                categoryList[cat].forEach(item => {
                    optionsHTML += `<option value="${item}">${item}</option>`;
                });
                optionsHTML += '</optgroup>';
            }

            row.innerHTML = `
                <select class="item-select">${optionsHTML}</select>
                <input type="number" class="item-quantity" placeholder="S·ªë l∆∞·ª£ng" min="0" step="0.1" />
                <button class="btn btn-danger btn-small" onclick="this.parentElement.remove()">X√≥a</button>
            `;

            container.appendChild(row);
        }

        function getItemsFromContainer(containerId) {
            const container = document.getElementById(containerId);
            const rows = container.querySelectorAll('.item-row');
            const items = [];

            rows.forEach(row => {
                const name = row.querySelector('.item-select').value;
                const quantity = parseFloat(row.querySelector('.item-quantity').value);
                if (name && quantity > 0) items.push({ name, quantity });
            });

            return items;
        }

        // Init screens
        function initRawInput() {
            document.getElementById('rawItemsContainer').innerHTML = '';
            document.getElementById('rawSuccessMsg').innerHTML = '';
            addRawItem();
        }

        function addRawItem() {
            const rawCategories = {
                'Nguy√™n li·ªáu s·ªëng': categories['Nguy√™n li·ªáu s·ªëng'],
                'Gia v·ªã & nguy√™n li·ªáu kh√¥': categories['Gia v·ªã & nguy√™n li·ªáu kh√¥'],
                'Bao b√¨ & v·∫≠t d·ª•ng': categories['Bao b√¨ & v·∫≠t d·ª•ng'],
                'ƒê·ªì u·ªëng & b√°nh': categories['ƒê·ªì u·ªëng & b√°nh']
            };
            createItemRow('rawItemsContainer', rawCategories);
        }

        function initProdInput() {
            document.getElementById('prodItemsContainer').innerHTML = '';
            document.getElementById('prodSuccessMsg').innerHTML = '';
            addProdItem();
        }

        function addProdItem() {
            createItemRow('prodItemsContainer', {'Th√†nh ph·∫©m': categories['Th√†nh ph·∫©m']});
        }

        function initExportInput() {
            document.getElementById('exportItemsContainer').innerHTML = '';
            document.getElementById('exportSuccessMsg').innerHTML = '';
            addExportItem();
            loadExportHistory(); // Th√™m d√≤ng n√†y
        }

        function addExportItem() {
            createItemRow('exportItemsContainer', {
                'Nguy√™n li·ªáu s·ªëng': categories['Nguy√™n li·ªáu s·ªëng'],
                'Th√†nh ph·∫©m': categories['Th√†nh ph·∫©m'],
                'Gia v·ªã & nguy√™n li·ªáu kh√¥': categories['Gia v·ªã & nguy√™n li·ªáu kh√¥'],
                'Bao b√¨ & v·∫≠t d·ª•ng': categories['Bao b√¨ & v·∫≠t d·ª•ng'],
                'ƒê·ªì u·ªëng & b√°nh': categories['ƒê·ªì u·ªëng & b√°nh']
            });
        }

        // Save functions
        async function saveRawInput() {
            const items = getItemsFromContainer('rawItemsContainer');
            if (!items.length) return;
            for (let item of items) await updateInventory(item.name, item.quantity, 'raw_input');
            document.getElementById('rawSuccessMsg').innerHTML = '<div class="success-msg">‚úì ƒê√£ l∆∞u th√†nh c√¥ng!</div>';
            setTimeout(() => initRawInput(), 2000);
        }

        async function saveProduction() {
            const items = getItemsFromContainer('prodItemsContainer');
            if (!items.length) return;
            for (let item of items) await updateInventory(item.name, item.quantity, 'production');
            document.getElementById('prodSuccessMsg').innerHTML = '<div class="success-msg">‚úì ƒê√£ l∆∞u th√†nh c√¥ng!</div>';
            setTimeout(() => initProdInput(), 2000);
        }

        // S·ª≠a l·∫°i function saveExport() ƒë·ªÉ reload b·∫£ng sau khi l∆∞u
        async function saveExport() {
            const store = document.getElementById('storeSelect').value;
            const items = getItemsFromContainer('exportItemsContainer');
            if (!items.length) return;
            for (let item of items) await updateInventory(item.name, -item.quantity, 'export', store);
            document.getElementById('exportSuccessMsg').innerHTML = '<div class="success-msg">‚úì ƒê√£ xu·∫•t h√†ng th√†nh c√¥ng!</div>';
            await loadExportHistory(); // Reload b·∫£ng l·ªãch s·ª≠
            setTimeout(() => initExportInput(), 2000);
        }

        // Display Inventory - NEW CARD LAYOUT
        function displayInventory() {
            const container = document.getElementById('inventoryContainer');
            if (!container) return;
            container.innerHTML = '';

            const categoryClasses = {
                'Th√†nh ph·∫©m': 'cat-thanh-pham',
                'Nguy√™n li·ªáu s·ªëng': 'cat-nguyen-lieu',
                'Gia v·ªã & nguy√™n li·ªáu kh√¥': 'cat-gia-vi',
                'Bao b√¨ & v·∫≠t d·ª•ng': 'cat-bao-bi',
                'ƒê·ªì u·ªëng & b√°nh': 'cat-do-uong'
            };

            const categoryIcons = {
                'Th√†nh ph·∫©m': 'üçï',
                'Nguy√™n li·ªáu s·ªëng': 'ü•©',
                'Gia v·ªã & nguy√™n li·ªáu kh√¥': 'üßÇ',
                'Bao b√¨ & v·∫≠t d·ª•ng': 'üì¶',
                'ƒê·ªì u·ªëng & b√°nh': 'ü•§'
            };

            for (let cat in categories) {
                const items = categories[cat];
                const lowStockCount = items.filter(item => (inventoryData[item] || 0) < 3).length;
                
                // Category Card
                const card = document.createElement('div');
                card.className = 'category-card';
                card.dataset.category = cat;

                // Header
                const header = document.createElement('div');
                header.className = `category-header ${categoryClasses[cat] || ''}`;
                header.innerHTML = `
                    <div class="category-title">
                        <span class="category-icon">‚ñ∂</span>
                        <span>${categoryIcons[cat] || 'üìã'} ${cat}</span>
                    </div>
                    <div style="display:flex; align-items:center; gap:10px;">
                        ${lowStockCount > 0 ? `<span class="status-badge status-critical">‚ö†Ô∏è ${lowStockCount} s·∫Øp h·∫øt</span>` : ''}
                        <span class="category-count">${items.length} s·∫£n ph·∫©m</span>
                    </div>
                `;

                // Body
                const body = document.createElement('div');
                body.className = 'category-body';

                const grid = document.createElement('div');
                grid.className = 'item-grid';

                items.forEach(item => {
                    const qty = inventoryData[item] || 0;
                    let statusClass = '';
                    let statusBadge = '';

                    if (qty === 0) {
                        statusClass = 'low-stock';
                        statusBadge = '<span class="status-badge status-critical">‚ùå H·∫øt h√†ng</span>';
                    } else if (qty < 3) {
                        statusClass = 'low-stock';
                        statusBadge = '<span class="status-badge status-low">‚ö†Ô∏è S·∫Øp h·∫øt</span>';
                    } else {
                        statusBadge = '<span class="status-badge status-ok">‚úì ƒê·ªß h√†ng</span>';
                    }

                    const itemCard = document.createElement('div');
                    itemCard.className = `item-card ${statusClass}`;
                    itemCard.dataset.itemName = item;
                    itemCard.innerHTML = `
                        <div class="item-name">${item}</div>
                        <div class="item-controls">
                            <input type="number" class="item-quantity" value="${qty}" step="0.1" min="0"
                                onchange="updateInventoryDirect('${item}', this.value)" />
                            ${statusBadge}
                        </div>
                    `;

                    grid.appendChild(itemCard);
                });

                body.appendChild(grid);
                card.appendChild(header);
                card.appendChild(body);
                container.appendChild(card);

                // Toggle functionality
                header.addEventListener('click', () => {
                    const icon = header.querySelector('.category-icon');
                    const isExpanded = body.classList.contains('show');
                    
                    if (isExpanded) {
                        body.classList.remove('show');
                        icon.classList.remove('expanded');
                    } else {
                        body.classList.add('show');
                        icon.classList.add('expanded');
                    }
                });
            }
        }

        function searchInventory() {
            const keyword = document.getElementById('inventorySearch').value.trim().toLowerCase();
            const cards = document.querySelectorAll('.category-card');

            cards.forEach(card => {
                const items = card.querySelectorAll('.item-card');
                let visibleCount = 0;

                items.forEach(itemCard => {
                    const name = itemCard.dataset.itemName.toLowerCase();
                    if (name.includes(keyword)) {
                        itemCard.style.display = 'flex';
                        visibleCount++;
                    } else {
                        itemCard.style.display = 'none';
                    }
                });

                // Auto expand if search has results
                const body = card.querySelector('.category-body');
                const icon = card.querySelector('.category-icon');
                
                if (keyword && visibleCount > 0) {
                    body.classList.add('show');
                    icon.classList.add('expanded');
                    card.style.display = 'block';
                } else if (keyword && visibleCount === 0) {
                    card.style.display = 'none';
                } else {
                    card.style.display = 'block';
                }
            });
        }

        function updateInventoryDirect(itemName, newValue) {
            const diff = (parseFloat(newValue) || 0) - (inventoryData[itemName] || 0);
            updateInventory(itemName, diff, 'manual');
        }

        function displayAlerts() {
            const container = document.getElementById('alertsContainer');
            container.innerHTML = '';
            let lowStockItems = [];

            for (const [groupName, items] of Object.entries(categories)) {
                items.forEach(item => {
                    const qty = parseFloat(inventoryData[item] || 0);
                    if (qty < 3) lowStockItems.push({ name: item, quantity: qty });
                });
            }

            if (!lowStockItems.length) {
                container.innerHTML = '<div class="alert">‚úì Kh√¥ng c√≥ m·∫∑t h√†ng n√†o s·∫Øp h·∫øt!</div>';
            } else {
                let html = `
                    <div class="alert">
                        <p style="margin-bottom:15px;"><strong>‚ö†Ô∏è C√≥ ${lowStockItems.length} m·∫∑t h√†ng s·∫Øp h·∫øt ho·∫∑c ƒë√£ h·∫øt!</strong></p>
                        <table class="alert-table">
                            <thead>
                                <tr>
                                    <th width="50">
                                        <input type="checkbox" id="selectAll" onchange="toggleAllOrders(this.checked)" />
                                    </th>
                                    <th>M·∫∑t h√†ng</th>
                                    <th width="100">T·ªìn kho</th>
                                    <th width="120">S·ªë l∆∞·ª£ng ƒë·∫∑t</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                lowStockItems.forEach((item, index) => {
                    const suggestedQty = item.quantity === 0 ? 10 : 5;
                    html += `
                        <tr>
                            <td style="text-align:center;">
                                <input type="checkbox" class="order-checkbox" data-item="${item.name}" data-index="${index}" />
                            </td>
                            <td><strong>${item.name}</strong></td>
                            <td style="color: ${item.quantity === 0 ? 'red' : 'orange'}; font-weight: bold; text-align: center;">
                                ${item.quantity}
                            </td>
                            <td>
                                <input type="number" class="order-quantity" data-item="${item.name}" 
                                    value="${suggestedQty}" min="1" step="1" />
                            </td>
                        </tr>
                    `;
                });
                
                html += `
                            </tbody>
                        </table>
                        <div class="order-actions">
                            <button class="btn btn-secondary" onclick="clearAllOrders()">B·ªè ch·ªçn t·∫•t c·∫£</button>
                            <button class="btn btn-order" onclick="sendOrderToDiscord()">üì§ G·ª≠i ƒë∆°n ƒë·∫∑t h√†ng</button>
                        </div>
                    </div>
                `;
                container.innerHTML = html;
            }
        }
        async function loadStoreInventory() {
            const store = document.getElementById('storeInventorySelect').value;
            const container = document.getElementById('storeInventoryContainer');

            if (!store) {
                container.innerHTML = "";
                return;
            }

            container.innerHTML = `<p>‚è≥ ƒêang t·∫£i d·ªØ li·ªáu t·ªìn kho...</p>`;

            try {
                const { data, error } = await supabase
                    .from('ton_quan')
                    .select('inventory, date, created_at')
                    .eq('store_id', store)
                    .order('created_at', { ascending: false })
                    .limit(1);

                if (error) throw error;
                if (!data || data.length === 0) {
                    container.innerHTML = `<p>‚ö†Ô∏è Ch∆∞a c√≥ d·ªØ li·ªáu t·ªìn kho cho qu√°n <b>${store}</b>.</p>`;
                    return;
                }

                const record = data[0];
                const inventory = record.inventory || {};
                const dateStr = record.date 
                    ? new Date(record.date).toLocaleDateString('vi-VN')
                    : new Date(record.created_at).toLocaleString('vi-VN');

                let html = `
                    <h3>üì¶ T·ªìn kho qu√°n ${store}</h3>
                    <p style="color:#777;">C·∫≠p nh·∫≠t g·∫ßn nh·∫•t: ${dateStr}</p>
                    <table border="1" cellspacing="0" cellpadding="6" style="border-collapse: collapse; width:100%;">
                        <thead style="background:#f3f3f3;">
                            <tr><th style="text-align:left;">M·∫∑t h√†ng</th><th>S·ªë l∆∞·ª£ng</th></tr>
                        </thead>
                        <tbody>
                `;

                for (const [item, qty] of Object.entries(inventory)) {
                    const color = qty < 3 ? 'red' : 'black';
                    html += `<tr><td>${item}</td><td style="color:${color};">${qty}</td></tr>`;
                }

                html += `</tbody></table>`;
                container.innerHTML = html;

            } catch (err) {
                console.error('‚ùå L·ªói load t·ªìn kho:', err);
                container.innerHTML = `<p style="color:red;">L·ªói t·∫£i d·ªØ li·ªáu t·ªìn kho. Vui l√≤ng th·ª≠ l·∫°i.</p>`;
            }
        }

        // Navigation
        function showScreen(screen) {
            document.getElementById('mainScreen').style.display = 'none';
            ['rawInputScreen','productionInputScreen','exportProductScreen','inventoryScreen','alertsScreen','storeInventoryScreen']
                .forEach(s => document.getElementById(s).style.display='none');

            switch(screen) {
                case 'rawInput': document.getElementById('rawInputScreen').style.display='block'; initRawInput(); break;
                case 'productionInput': document.getElementById('productionInputScreen').style.display='block'; initProdInput(); break;
                case 'exportProduct': document.getElementById('exportProductScreen').style.display='block'; initExportInput(); break;
                case 'inventory': document.getElementById('inventoryScreen').style.display='block'; displayInventory(); break;
                case 'alerts': document.getElementById('alertsScreen').style.display='block'; displayAlerts(); break;
                case 'storeInventory': document.getElementById('storeInventoryScreen').style.display = 'block'; break;
            }
        }

        function backToMenu() {
            ['rawInputScreen','productionInputScreen','exportProductScreen','inventoryScreen','alertsScreen','storeInventoryScreen']
                .forEach(s => document.getElementById(s).style.display='none');
            document.getElementById('mainScreen').style.display='block';
        }

        function toggleAllOrders(checked) {
                const checkboxes = document.querySelectorAll('.order-checkbox');
                checkboxes.forEach(cb => cb.checked = checked);
            }

            function clearAllOrders() {
                document.getElementById('selectAll').checked = false;
                toggleAllOrders(false);
            }

            async function sendOrderToDiscord() {
                const checkboxes = document.querySelectorAll('.order-checkbox:checked');
                
                if (checkboxes.length === 0) {
                    alert('‚ö†Ô∏è Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt m·∫∑t h√†ng ƒë·ªÉ ƒë·∫∑t!');
                    return;
                }

                const orders = [];
                checkboxes.forEach(cb => {
                    const itemName = cb.dataset.item;
                    const qtyInput = document.querySelector(`.order-quantity[data-item="${itemName}"]`);
                    const quantity = parseInt(qtyInput.value) || 0;
                    
                    if (quantity > 0) {
                        const currentStock = inventoryData[itemName] || 0;
                        orders.push({
                            name: itemName,
                            currentStock: currentStock,
                            orderQty: quantity
                        });
                    }
                });

                if (orders.length === 0) {
                    alert('‚ö†Ô∏è Kh√¥ng c√≥ m·∫∑t h√†ng n√†o c√≥ s·ªë l∆∞·ª£ng h·ª£p l·ªá!');
                    return;
                }

                // T·∫°o n·ªôi dung ƒë∆°n ƒë·∫∑t h√†ng
                const now = new Date();
                const dateStr = now.toLocaleDateString('vi-VN');
                const timeStr = now.toLocaleTimeString('vi-VN');
                
                let orderMessage = `üçï **ƒê∆†N ƒê·∫∂T H√ÄNG - PIZZA TIME**\n\n`;
                orderMessage += `üìÖ **Ng√†y:** ${dateStr} - ${timeStr}\n`;
                orderMessage += `üë§ **Ng∆∞·ªùi ƒë·∫∑t:** ${currentUser}\n`;
                orderMessage += `üì¶ **S·ªë m·∫∑t h√†ng:** ${orders.length}\n\n`;
                orderMessage += `**CHI TI·∫æT ƒê∆†N H√ÄNG:**\n`;
                orderMessage += `${'='.repeat(50)}\n`;
                
                orders.forEach((order, idx) => {
                    orderMessage += `${idx + 1}. **${order.name}**\n`;
                    orderMessage += `   ‚îî T·ªìn kho hi·ªán t·∫°i: ${order.currentStock}\n`;
                    orderMessage += `   ‚îî S·ªë l∆∞·ª£ng ƒë·∫∑t: **${order.orderQty}**\n\n`;
                });
                
                orderMessage += `${'='.repeat(50)}\n`;
                orderMessage += `‚ö†Ô∏è *Vui l√≤ng x√°c nh·∫≠n v√† x·ª≠ l√Ω ƒë∆°n h√†ng n√†y!*`;

                // G·ª≠i ƒë·∫øn Discord
                try {
                    const response = await fetch(DISCORD_WEBHOOK_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            content: orderMessage,
                            username: 'Pizza Time Bot',
                            avatar_url: 'https://em-content.zobj.net/thumbs/120/apple/354/pizza_1f355.png'
                        })
                    });

                    if (response.ok) {
                        alert('‚úÖ ƒê√£ g·ª≠i ƒë∆°n ƒë·∫∑t h√†ng th√†nh c√¥ng!');
                        
                        // L∆∞u ƒë∆°n h√†ng v√†o Supabase (optional)
                        const orderData = {
                            date: now.toISOString().slice(0, 10),
                            time: timeStr,
                            user_name: currentUser,
                            items: orders,
                            total_items: orders.length
                        };
                        
                        await supabase.from('orders').insert([orderData]);
                        
                        // Reset form
                        clearAllOrders();
                    } else {
                        throw new Error('Discord webhook response not OK');
                    }
                } catch (error) {
                    console.error('‚ùå L·ªói g·ª≠i ƒë∆°n h√†ng:', error);
                    alert('‚ùå Kh√¥ng th·ªÉ g·ª≠i ƒë∆°n h√†ng. Vui l√≤ng ki·ªÉm tra l·∫°i Discord Webhook URL!');
                }
            }

            // Th√™m function load l·ªãch s·ª≠ xu·∫•t h√†ng
            async function loadExportHistory() {
                const container = document.getElementById('exportHistoryContainer');
                if (!container) return;

                try {
                    // L·∫•y ng√†y m·ªõi nh·∫•t c√≥ d·ªØ li·ªáu xu·∫•t h√†ng
                    const { data: latestData, error: latestError } = await supabase
                        .from('exports')
                        .select('date')
                        .order('date', { ascending: false })
                        .limit(1);

                    if (latestError) throw latestError;

                    if (!latestData || latestData.length === 0) {
                        container.innerHTML = '<div class="no-data">Ch∆∞a c√≥ d·ªØ li·ªáu xu·∫•t h√†ng n√†o</div>';
                        return;
                    }

                    const latestDate = latestData[0].date;

                    // L·∫•y t·∫•t c·∫£ ƒë∆°n xu·∫•t h√†ng c·ªßa ng√†y ƒë√≥
                    const { data: exports, error } = await supabase
                        .from('exports')
                        .select('*')
                        .eq('date', latestDate)
                        .order('created_at', { ascending: false });

                    if (error) throw error;

                    if (!exports || exports.length === 0) {
                        container.innerHTML = '<div class="no-data">Kh√¥ng c√≥ d·ªØ li·ªáu xu·∫•t h√†ng</div>';
                        return;
                    }

                    // Nh√≥m theo qu√°n
                    const groupedByStore = {};
                    exports.forEach(exp => {
                        if (!groupedByStore[exp.store]) {
                            groupedByStore[exp.store] = [];
                        }
                        groupedByStore[exp.store].push(exp);
                    });

                    // T·∫°o HTML
                    let html = `
                        <p style="margin-bottom:15px; color:#666;">
                            <strong>üìÖ Ng√†y:</strong> ${new Date(latestDate).toLocaleDateString('vi-VN')}
                        </p>
                        <table class="export-history-table">
                            <thead>
                                <tr>
                                    <th width="80">Qu√°n</th>
                                    <th>M·∫∑t h√†ng</th>
                                    <th width="100">S·ªë l∆∞·ª£ng</th>
                                    <th width="150">Ng∆∞·ªùi xu·∫•t</th>
                                    <th width="100">Th·ªùi gian</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;

                    for (const [store, items] of Object.entries(groupedByStore)) {
                        items.forEach((exp, idx) => {
                            const time = exp.created_at 
                                ? new Date(exp.created_at).toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' })
                                : '--:--';
                            
                            html += `
                                <tr>
                                    ${idx === 0 ? `<td rowspan="${items.length}"><span class="store-badge ${store}">${store}</span></td>` : ''}
                                    <td>${exp.item}</td>
                                    <td style="text-align:center; font-weight:600;">${exp.quantity}</td>
                                    <td>${exp.user_name || 'N/A'}</td>
                                    <td style="text-align:center;">${time}</td>
                                </tr>
                            `;
                        });
                    }

                    html += `
                            </tbody>
                        </table>
                    `;

                    container.innerHTML = html;

                } catch (err) {
                    console.error('‚ùå L·ªói load l·ªãch s·ª≠ xu·∫•t h√†ng:', err);
                    container.innerHTML = '<div class="no-data" style="color:red;">L·ªói t·∫£i d·ªØ li·ªáu</div>';
                }
            }


    </script>
</body>
</html>
